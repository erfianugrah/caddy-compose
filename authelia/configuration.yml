---
# Authelia configuration
# Secrets are injected via environment variables (AUTHELIA_*_FILE or AUTHELIA_*)
# See .env for the required variables.

server:
  address: 'tcp4://:9091'

log:
  level: 'info'
  file_path: '/config/authelia.log'
  keep_stdout: true

theme: 'auto'

identity_validation:
  elevated_session:
    require_second_factor: true
  reset_password:
    jwt_lifespan: '5 minutes'

totp:
  disable: false
  issuer: 'erfi.io'
  period: 30
  skew: 1

webauthn:
  disable: false
  display_name: 'Authelia (erfi.io)'
  attestation_conveyance_preference: 'indirect'
  selection_criteria:
    user_verification: 'preferred'

password_policy:
  zxcvbn:
    enabled: true
    min_score: 4

authentication_backend:
  file:
    path: '/config/users_database.yml'
    watch: true
    password:
      algorithm: 'argon2'
      argon2:
        variant: 'argon2id'
        iterations: 3
        memory: 65536
        parallelism: 4
        key_length: 32
        salt_length: 16

access_control:
  default_policy: 'deny'
  rules:
    # Authelia own endpoints must be accessible
    - domain: 'authelia.erfi.io'
      policy: 'bypass'

    # Servarr dashboard — require two-factor
    - domain: 'servarr.erfi.io'
      policy: 'two_factor'

    # All other erfi.io services — no Authelia enforcement (they have their own auth)
    # Add more rules here as you expand Authelia protection to other services.

session:
  name: 'authelia_session'
  cookies:
    - domain: 'erfi.io'
      authelia_url: 'https://authelia.erfi.io'
      default_redirection_url: 'https://servarr.erfi.io'
      same_site: 'lax'
      inactivity: '1h'
      expiration: '8h'
      remember_me: '1M'

regulation:
  max_retries: 4
  find_time: '2m'
  ban_time: '5m'

storage:
  local:
    path: '/config/db.sqlite3'

notifier:
  # Filesystem notifier for development — TOTP registration links are written to this file.
  # Replace with SMTP for production use.
  filesystem:
    filename: '/config/notification.txt'
...
